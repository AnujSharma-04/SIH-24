<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Option</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="/static/styles.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
</head>
<body>
    <div class="container mt-5 text-center">
        <h1 class="mb-4">Webcam Capture and Recording</h1>
        <video id="webCam" autoplay playsinline width="800" height="600" class="mb-3"></video>
        <canvas id="canvas" style="display: none;"></canvas>
        <button id="snapButton" class="btn btn-primary">SNAP</button>
        <a id="downloadLink" class="btn btn-success" style="display: none;" download="snapshot.png">Download Snapshot</a>
        <br><br>
        <button id="startRecordButton" class="btn btn-warning">Start Recording</button>
        <button id="stopRecordButton" class="btn btn-danger" style="display: none;">Stop Recording</button>
        <a id="downloadVideoLink" class="btn btn-info" style="display: none;" download="video.mp4">Download Video</a>
    </div>

    <script>
    // Initialize the webcam
    const webCamElement = document.getElementById("webCam");
    const canvasElement = document.getElementById("canvas");
    const snapButton = document.getElementById("snapButton");
    const downloadLink = document.getElementById("downloadLink");
    const startRecordButton = document.getElementById("startRecordButton");
    const stopRecordButton = document.getElementById("stopRecordButton");
    const downloadVideoLink = document.getElementById("downloadVideoLink");

    const webcam = new Webcam(webCamElement, "user", canvasElement);
    let mediaRecorder;
    let recordedChunks = [];

    // Start the webcam
    webcam.start()
      .then(result => {
        console.log("Webcam started");
      })
      .catch(err => {
        console.log(err);
      });

    // Capture a snapshot
    snapButton.addEventListener("click", () => {
        const picture = webcam.snap(); // Capture the picture
        downloadLink.href = picture; // Set the href of the download link
        downloadLink.style.display = "inline"; // Show the download link
    });

    // Start recording
    startRecordButton.addEventListener("click", () => {
        recordedChunks = [];
        const stream = webCamElement.srcObject;
        mediaRecorder = new MediaRecorder(stream);

        mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
                recordedChunks.push(event.data);
            }
        };

        mediaRecorder.onstop = () => {
            const blob = new Blob(recordedChunks, { type: 'video/mp4' });
            const url = URL.createObjectURL(blob);
            downloadVideoLink.href = url;
            downloadVideoLink.style.display = "inline"; // Show the download link
        };

        mediaRecorder.start();
        startRecordButton.style.display = "none";
        stopRecordButton.style.display = "inline";
    });

    // Stop recording
    stopRecordButton.addEventListener("click", () => {
        mediaRecorder.stop();
        startRecordButton.style.display = "inline";
        stopRecordButton.style.display = "none";
    });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
</body>
</html>
